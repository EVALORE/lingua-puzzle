@let cardHeight = 35;
@let numberOfSentences = 10;
@let resultHeight = cardHeight * numberOfSentences + 'px';

<app-hints/>

<mat-card [style]="{ height: resultHeight }">
  @for (sentence of completedSentences; track sentence) {
    @let isFirstSentence = $index === 0;
    @let isLastSentence = $index === numberOfSentences - 1;
    <div class="result completed">
      @for (card of sentence; track card) {
        @let isFirstCard = $index === 0;
        @let isLastCard = $index === sentence.length - 1;
        <div
          class="word"
          [style]="{
            width: card.width,
            backgroundImage: 'url(' + image + ')',
            backgroundSize: '700px ' + resultHeight,
            backgroundPosition: '-' + card.xOffset + 'px ' + '-' + card.yOffset + 'px',
            backgroundRepeat: 'no-repeat',
            borderRadius:
              isFirstSentence && isFirstCard
                ? '8px 0 0 0'
                : isFirstSentence && isLastCard
                  ? '0 8px 0 0'
                  : isLastSentence && isLastCard
                    ? '0 0 8px 0 '
                    : isLastSentence && isFirstCard
                      ? '0 0 0 8px'
                      : '0',
          }"
        >
          <span>
            {{ card.word }}
          </span>
        </div>
      }
    </div>
  }
  <div
    class="result"
    cdkDropList
    #resultList="cdkDropList"
    cdkDropListOrientation="horizontal"
    [cdkDropListData]="result()"
    [cdkDropListConnectedTo]="[sourceList]"
    (cdkDropListDropped)="drop($event)"
  >
    @for (card of result(); track card) {
      <mat-card
        appWordCard
        class="word"
        [class.correct]="card.positionStatus === 'CORRECT'"
        [class.wrong]="card.positionStatus === 'WRONG'"
        [style]="{
          width: card.width,
          backgroundImage: 'url(' + image + ')',
          backgroundSize: '700px ' + resultHeight,
          backgroundPosition: '-' + card.xOffset + 'px ' + '-' + card.yOffset + 'px',
          backgroundRepeat: 'no-repeat',
        }"
        (click)="moveToSource($index)"
        @filterAnimation
        cdkDrag
      >
        <span>
          {{ card.word }}
        </span>
      </mat-card>
    }
  </div>
</mat-card>

<div
  class="source"
  cdkDropList
  #sourceList="cdkDropList"
  cdkDropListOrientation="horizontal"
  cdkDropList
  [cdkDropListData]="source()"
  [cdkDropListConnectedTo]="[resultList]"
  (cdkDropListDropped)="drop($event)"
>
  @for (card of source(); track card) {
    <mat-card
      appWordCard
      class="word"
      [style]="{
        width: card.width,
        backgroundImage: 'url(' + image + ')',
        backgroundSize: '700px ' + resultHeight,
        backgroundPosition: '-' + card.xOffset + 'px ' + '-' + card.yOffset + 'px',
        backgroundRepeat: 'no-repeat',
      }"
      (click)="moveToResult($index)"
      @filterAnimation
      cdkDrag
    >
      <span>
        {{ card.word }}
      </span>
    </mat-card>
  }
</div>

@if (source().length === 0) {
  <button mat-raised-button (click)="startResultAutoComplete()">Auto Complete</button>
  <button
    mat-raised-button
    color="primary"
    (click)="isWin() ? nextSentence() : startCardsChecking()"
  >
    {{ isWin() ? 'Continue' : 'Check' }}
  </button>
}
